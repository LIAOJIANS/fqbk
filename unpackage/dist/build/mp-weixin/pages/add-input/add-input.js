(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/add-input/add-input"],{"0c66":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("4795"));function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){return l(t)||u(t,e)||o(t,e)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(t,e){if(t){if("string"===typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function u(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,a=!1,s=void 0;try{for(var r,o=t[Symbol.iterator]();!(i=(r=o.next()).done);i=!0)if(n.push(r.value),e&&n.length===e)break}catch(c){a=!0,s=c}finally{try{i||null==o["return"]||o["return"]()}finally{if(a)throw s}}return n}}function l(t){if(Array.isArray(t))return t}function p(t,e,n,i,a,s,r){try{var o=t[s](r),c=o.value}catch(u){return void n(u)}o.done?e(c):Promise.resolve(c).then(i,a)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(i,a){var s=t.apply(e,n);function r(t){p(s,i,a,r,o,"next",t)}function o(t){p(s,i,a,r,o,"throw",t)}r(void 0)}))}}var d=["所有人可看","仅自己可看"],h=function(){n.e("components/common/uploud-images").then(function(){return resolve(n("9aa4"))}.bind(null,n)).catch(n.oe)},g=function(){n.e("components/uni-nav-bar/uni-nav-bar").then(function(){return resolve(n("d353"))}.bind(null,n)).catch(n.oe)},v=function(){n.e("components/uni-popup/uni-popup").then(function(){return resolve(n("bf5c"))}.bind(null,n)).catch(n.oe)},m={data:function(){return{context:0,textValue:"",imageList:[],isShowAlert:!0,isSave:!1,imglistIds:[],postclass:{id:0,title:"",range:[],list:[]},topic:{id:0,title:""}}},computed:{getType:function(){return d[this.context]}},onLoad:function(e){var n=this,i=t.getStorageSync("addinput");i&&(i=JSON.parse(i),this.context=i.context||0,this.imglistIds=i.imglistIds||[],this.imglistIds.length&&(this.imglist=i.imglist),this.textValue=i.textValue||"",i.postclass&&(this.postclass=i.postclass),i.topic&&(this.topic=i.topic));var a=!!e.postclass&&JSON.parse(e.postclass);this.getPostClass(a),t.$on("changeTopic",(function(t){n.topic.id=t.id,n.topic.title="#".concat(t.title,"#")}))},onBackPress:function(){if(this.textValue||!(this.imageList.length<1))return this.isSave?void 0:(this.saveDraft(),!0)},methods:{changeTopic:function(){t.navigateTo({url:"/pages/topic-nav/topic-nav?ischange="+!0})},getPostClass:function(t){var e=this;return f(i.default.mark((function n(){var a,r,o,c,u,l,p,f,d,h;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t){n.next=5;break}for(e.postclass.list=t,a=[],r=0;r<t.length;r++)a.push(t[r].name);return n.abrupt("return",e.postclass.range=a);case 5:return n.prev=5,n.next=8,e.$http.get("/postclass");case 8:if(o=n.sent,c=s(o,2),u=c[0],l=c[1],e.$http.errorCheck(u,l)){n.next=14;break}return n.abrupt("return");case 14:for(p=l.data.data.list,f=[],d=[],h=0;h<p.length;h++)f.push(p[h].classname),d.push({id:p[h].id,name:p[h].classname});e.postclass.range=f,e.postclass.list=d,n.next=24;break;case 21:return n.prev=21,n.t0=n["catch"](5),n.abrupt("return");case 24:case"end":return n.stop()}}),n,null,[[5,21]])})))()},saveDraft:function(){var e=this;t.showModal({content:"是否保存为草稿",cancelText:"不保存",confirmText:"保存",success:function(n){if(n.confirm){var i={yinsi:e.yinsi,text:e.text,imglist:e.imglist,imglistIds:e.imglistIds,postclass:e.postclass,topic:e.topic};t.setStorageSync("addinput",JSON.stringify(i))}else t.removeStorage({key:"addinput"});e.isSave=!0,e.back()}})},changePostClass:function(t){this.postclass.id=this.postclass.list[t.target.value].id,this.postclass.title=this.postclass.list[t.target.value].name},back:function(){t.navigateBack({delta:1})},submit:function(){var e=this;return f(i.default.mark((function n(){var a,r,o,c;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.postclass.id){n.next=2;break}return n.abrupt("return",t.showToast({title:"请选择分类",icon:"none"}));case 2:return t.showLoading({title:"发布中...",mask:!0}),n.prev=3,n.next=6,e.$http.post("/post/create",{imglist:JSON.stringify(e.imglistIds),text:e.textValue,isopen:e.context,topic_id:e.topic.id,post_class_id:e.postclass.id},{token:!0,checkToken:!0,checkAuth:!0});case 6:if(a=n.sent,r=s(a,2),o=r[0],c=r[1],e.$http.errorCheck(o,c)){n.next=12;break}return n.abrupt("return",t.hideLoading());case 12:t.hideLoading(),t.showToast({title:"发布成功！"}),e.isSave=!0,t.$emit("updateData",{type:"updateList",data:c.data.data.detail}),e.back(),n.next=22;break;case 19:return n.prev=19,n.t0=n["catch"](3),n.abrupt("return");case 22:case"end":return n.stop()}}),n,null,[[3,19]])})))()},changeLook:function(){var e=this;t.showActionSheet({itemList:d,success:function(t){e.context=t.tapIndex}})},changeImages:function(t){this.imageList.push(t.url),console.log(this.imageList),this.imglistIds.push({id:t.id})},delImageList:function(t){this.imageList.splice(t,1),this.imglistIds.splice(t,1)},hideAlert:function(){this.isShowAlert=!1}},components:{uniNavBar:g,uploudImages:h,uniPopup:v}};e.default=m}).call(this,n("543d")["default"])},"788e":function(t,e,n){"use strict";n.r(e);var i=n("a1c3"),a=n("7bf1");for(var s in a)"default"!==s&&function(t){n.d(e,t,(function(){return a[t]}))}(s);n("7ada");var r,o=n("f0c5"),c=Object(o["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],r);e["default"]=c.exports},"7ada":function(t,e,n){"use strict";var i=n("98a7"),a=n.n(i);a.a},"7bf1":function(t,e,n){"use strict";n.r(e);var i=n("0c66"),a=n.n(i);for(var s in i)"default"!==s&&function(t){n.d(e,t,(function(){return i[t]}))}(s);e["default"]=a.a},"98a7":function(t,e,n){},a0e8:function(t,e,n){"use strict";(function(t){n("b02b"),n("921b");i(n("66fd"));var e=i(n("788e"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},a1c3:function(t,e,n){"use strict";var i,a=function(){var t=this,e=t.$createElement;t._self._c},s=[];n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i}))}},[["a0e8","common/runtime","common/vendor"]]]);